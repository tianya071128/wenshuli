<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>基础流程</title>
    <script src="./vue.js"></script>
  </head>
  <body>
    <div id="root">
      <div>{{a}}</div>
      <div>{{b.c}}</div>
      <div>{{d[0]}}</div>
      <div>{{f.a}}</div>
      <!-- <my-components @test="console.log('测试一下')"></my-components> -->
    </div>
  </body>
</html>

<script>
  /**
   * vue 是分多平台，如 web 就区分 ssr、web等、还区分 weex
   * 在这里主要看下 web 平台的不带编译器的，入口为 platforms/web/entry-runtime.js
   *
   * 首先会在 code/index.js中，会做如下工作，这些是不分平台的工作(也就是各环境都会经过这里)：
   *   为 Vue.prototype 添加一些属性和方法 -- code/instance/index.js
   *   为 Vue 添加静态属性和方法 -- code/index.js 的 initGlobalAPI 方法中
   *
   * 在 web 端不使用编译器(compiler)情况下，会通过 platforms/runtime/index.js 做一些 web 端渲染的工作
   *  并且添加 model 和 show 全局指令 以及 添加 Transition、TransitionGroup 全局内置组件
   *
   * 至此，引用 Vue 就会做如上处理，之后等待使用 Vue 构造函数处理
   */
  Vue.mixin({
    data() {
      return {
        aa: 1,
      };
    },
    methods: {
      test() {},
    },
  });

  /**
   * 初始根组件(即通过 new 创建的组件，区别于子组件)流程：
   *  主要在 code/instance/init.js 的 _init 方法中初始化
   *  详见 _init 方法注解
   */
  // new Vue 后，会调用 code/instance/index.js 中 Vue 构造函数
  new Vue({
    el: '#root',
    data() {
      return {
        a: 1,
        b: {
          c: 2,
        },
        d: [1, 2],
        e: [
          {
            f: 2,
            g: 3,
          },
        ],
        f: {
          a: 1,
          b: {
            c: 2,
          },
        },
      };
    },
    props: {
      test1: Array,
      test2: {
        type: Number,
      },
      test3: {
        type: String,
        default: '1',
      },
    },
    watch: {
      'f.b.c'(val, oldVal) {
        console.log(val, oldVal);
      },
    },
    created() {
      setTimeout(() => {
        this.$set(this.f, 'c', 3);
      }, 0);
      // this.f.b.c = 5;
    },
  });
</script>
