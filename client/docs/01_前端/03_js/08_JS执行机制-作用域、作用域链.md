---
title: JS执行机制-作用域、作用域链
date: 2021-10-21 15:00:00
permalink: /js/scope
categories: 
  - 前端
  - JS
tags: 
  - null
---
# JS执行机制-作用域、作用域链

::: tip 你不知道的 JavaScript 上 P4

几乎所有语言的最基础模型之一就是在变量中存储值，并且在稍后取出或修改这些值。在变量中存储值和取出值的能力，给程序赋予了状态。

这就引伸出一些问题：这些变量被存储在哪里？程序如何在需要的时候找到它们？

这些问题需要一组明确定义的规则，它定义了如何存储变量，以及如何找到这些变量。我们称这组规则为：**作用域**。

:::

## 作用域

**简单来说，作用域 指程序中定义变量的区域，它决定了当前执行代码对变量的访问权限。**

在 JS 中，主要有以下几种作用域：

* 全局作用域：全局作用域为程序的最外层作用域，一直存在。

* 函数作用域：**函数作用域只有函数被定义时才会创建**，函数调用时会创建函数作用域，并将其压入到函数的作用域链的顶端形成作用域链。

* 块作用域：

  * 在 ES6 之前，块作用域比较少，主要可以通过 `with`、`try...catch(e) {}`等少数地方才存在

    ![image-20211125110314240](/img/47.png)

  * ES6 正式推出了 `let`、`const` 声明块级作用域的方式。

## 作用域链

当一个块或函数嵌套在另一个块或函数中时，就产生了作用域链。当查找变量时，在当前作用域无法找到时，引擎就会在作用域链中继续查找，直到找到该变量，或抵达最外层的作用域（也就是全局作用域）为止。

::: warning 注意

作用域和作用域链是规定变量访问的一套机制。

原型和原型链是对象属性访问的一套机制。

:::

### 作用域链何时创建的？

当一个函数被创建时，就会根据函数位置（JS 是词法作用域）来创建函数的非自身作用域链，**函数对象内部属性 [[Scopes]] 就引用着这个作用域链**,，而不需要等到函数执行时创建。

等到函数调用时，就会将函数的作用域添加到已经创建好的作用域链最前端。

::: tip 提示

因为 JS 是词法作用域，函数创建时根据函数定义的位置就可以推断出函数的作用域链（不包含自身的）。

而函数自身的作用域需要等到函数调用时才能确定（函数调用时才能确定的 this、变量、实参等）

:::

## 词法作用域

作用域有两种主要的工作模式

## 参考

* [知乎-JS中的作用域链是在什么时候建立的？](https://www.zhihu.com/question/36751764)
* 