---
title: 导航流程：输入 URL 到页面展示
date: 2021-10-21 15:00:00
permalink: /browser/navigation
categories:
  - 前端
  - 浏览器
tags:
  - null
---

# 导航流程

从输入 URL 到页面展示完整流程示意图，其中，用户发出 URL 请求到页面开始解析的这个过程，就叫做导航。：

![img](/img/99.png)

## 用户输入

当用户在地址栏输入关键字时：

* 如果是搜索内容，就会使用浏览器默认的搜索引擎，来合成新的带搜索关键字的 URL。
* 如果是一个 URL 地址，就会根据规则，合成为完整的 URL。

得到需要导航的 URL 后，浏览器还给了当前页面一次执行 `beforeunload` 事件的机会，`beforeunload` 事件允许页面在退出之前执行一些数据清理操作，还可以询问用户是否要离开当前页面

当前页面没有监听 beforeunload 事件或者同意了继续后续流程，进入加载状态，**需要等待提交文档阶段，页面内容才会被替换**。那么浏览器便进入下图的状态：

![image-20220516165906641](/img/100.png)

## 开始导航

获取到导航 URL 后，浏览器进程会通过进程间通信（IPC）把 URL 请求发送至网络进程，由网络进程请求资源

## URL 请求过程

网络进程接收到 URL 请求后，会在这里发起真正的 URL 请求流程，网络请求过程见 [http 模块](/http/)

## 读取响应头信息

网络进程接收到响应行和响应头之后，就开始解析响应头的内容。

### 重定向

如果发现返回的状态码是 301 或者 302，那么说明服务器需要浏览器重定向到其他 URL。

这时网络进程会从响应头的 Location 字段里面读取重定向的地址，然后再发起新的 HTTP 或者 HTTPS 请求，一切又重头开始了，此时会通知浏览器进程重定向

### 响应数据处理

根据 `Content-Type` 响应字段，可以知道服务器返回的响应体数据是什么类型，浏览器根据响应数据类型来决定如何显示响应体的内容

* 如果 Content-Type 字段的值被浏览器判断为下载类型，那么该请求会被提交给浏览器的下载管理器，同时该 URL 请求的导航流程就此结束
* 如果是 `application/pdf`，那么就会通过 `pdf` 处理程序处理 `pdf`
* 如果是 HTML，那么浏览器则会继续进行导航流程，**此时页面渲染需要渲染进程，所以接下来就准备渲染进程了**

## 准备渲染进程

当处理资源需要渲染页面时，Chrome 默认会为每个页面分配一个渲染进程。但有一些特殊情况下，如果从 A 页面打开 B 页面，且 A 和 B 都属于同一站点的话，那么 B 页面复用 A 页面的渲染进程；如果是其他情况，浏览器进程则会为 B 创建一个新的渲染进程。





